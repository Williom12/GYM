<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GYM</title>

<link rel="manifest" href="manifest.json">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
background:#000;
color:#fff;
font-family:Arial;
margin:0;
}

header{
background:#111;
text-align:center;
padding:15px;
font-size:22px;
font-weight:bold;
letter-spacing:2px;
}

.menu{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:8px;
background:#111;
padding:10px;
}

button{
background:#222;
color:white;
border:none;
padding:10px 14px;
border-radius:8px;
cursor:pointer;
}

.container{
max-width:850px;
margin:auto;
padding:20px;
}

input{
background:#111;
border:1px solid #444;
color:white;
padding:6px;
width:70px;
margin:4px;
border-radius:6px;
}

.card{
background:#111;
padding:15px;
border-radius:10px;
margin:10px 0;
}

.hidden{display:none}
.pr{color:#00ff88;font-weight:bold}
</style>
</head>

<body>

<header>GYM üí™</header>

<div id="perfil" class="container">
<h2>Selecciona perfil</h2>
<button onclick="setPerfil('William')">William</button>
<button onclick="setPerfil('JuanManuel')">Juan Manuel</button>
</div>

<div id="menu" class="menu hidden">
<button onclick="dia(1)">D1</button>
<button onclick="dia(2)">D2</button>
<button onclick="dia(3)">D3</button>
<button onclick="dia(4)">D4</button>
<button onclick="dia(5)">D5</button>
<button onclick="historial()">Historial</button>
<button onclick="progreso()">Progreso</button>
<button onclick="calendario()">Calendario</button>
</div>

<div id="app" class="container"></div>

<script>

let perfil="";

const rutina={
1:["Press inclinado","Fondos","Aperturas","Press cerrado","Extensi√≥n tr√≠ceps"],
2:["Dominadas","Remo barra","Jal√≥n pecho","Peso muerto rumano","Curl barra","Curl inclinado"],
3:["Sentadilla","Prensa","Curl femoral","Extensi√≥n cu√°driceps","Gemelos"],
4:["Press militar","Elevaciones laterales","Elevaciones posteriores","Encogimientos","Crunch peso"],
5:["Press banca","Dominadas","Remo mancuerna","Curl + Extensi√≥n"]
};

function setPerfil(p){
perfil=p;
document.getElementById("perfil").classList.add("hidden");
document.getElementById("menu").classList.remove("hidden");
}

const key=d=>perfil+"_dia"+d;

function limpiar(){ app.innerHTML=""; }

function dia(n){

limpiar();

let html=`<h2>Dia ${n} <input type="date" id="fecha"></h2>`;

rutina[n].forEach((e,i)=>{
html+=`${e}
<input id="kg${i}" placeholder="KG">
Reps <input id="rep${i}">
<span id="pr${i}" class="pr"></span><br>`;
});

html+=`<br><button onclick="guardar(${n})">Guardar</button>`;

app.innerHTML=html;

cargar(n);
mostrarPR(n);
}

function guardar(n){

let data={
fecha:fecha.value,
ej:[]
};

rutina[n].forEach((_,i)=>{
data.ej.push({
kg:Number(document.getElementById("kg"+i).value)||0,
rep:document.getElementById("rep"+i).value
});
});

localStorage.setItem(key(n),JSON.stringify(data));
alert("Guardado ‚úÖ");
}

function cargar(n){
let d=localStorage.getItem(key(n));
if(!d)return;
d=JSON.parse(d);

fecha.value=d.fecha;

d.ej.forEach((e,i)=>{
kg=i;
document.getElementById("kg"+i).value=e.kg;
document.getElementById("rep"+i).value=e.rep;
});
}

function mostrarPR(n){

rutina[n].forEach((_,i)=>{

let max=0;

for(let d=1;d<=5;d++){
let data=localStorage.getItem(key(d));
if(data){
data=JSON.parse(data);
if(data.ej[i])
max=Math.max(max,data.ej[i].kg);
}
}

if(max>0)
document.getElementById("pr"+i).innerText="üèÜ "+max+"kg";
});
}

function historial(){

limpiar();
let html="<h2>Historial</h2>";

for(let i=1;i<=5;i++){
let d=localStorage.getItem(key(i));
if(d){
d=JSON.parse(d);

html+=`
<div class="card">
Dia ${i}<br>
Fecha: ${d.fecha}<br><br>
<button onclick="dia(${i})">Abrir</button>
<button onclick="eliminar(${i})">Eliminar</button>
</div>`;
}
}

app.innerHTML=html;
}

function eliminar(n){
if(confirm("Eliminar d√≠a?")){
localStorage.removeItem(key(n));
historial();
}
}

/* -------- GRAFICO GENERAL -------- */

function progreso(){

limpiar();

app.innerHTML=`<h2>Progreso üìà</h2><canvas id="chart"></canvas>`;

let labels=[];
let data=[];

for(let d=1;d<=5;d++){
let info=localStorage.getItem(key(d));
if(info){
info=JSON.parse(info);

let total=0;
info.ej.forEach(e=>total+=e.kg);

labels.push("Dia "+d);
data.push(total);
}
}

new Chart(chart,{
type:'line',
data:{labels,
datasets:[{label:"Peso total (kg)",data,tension:.3}]},
options:{
plugins:{legend:{labels:{color:"white"}}},
scales:{
x:{ticks:{color:"white"}},
y:{ticks:{color:"white"}}
}
}
});
}

/* -------- CALENDARIO -------- */

function calendario(){

limpiar();
let html="<h2>Calendario üìÖ</h2>";

for(let d=1;d<=5;d++){
let info=localStorage.getItem(key(d));
if(info){
info=JSON.parse(info);
html+=`<div class="card">${info.fecha} ‚Äî Dia ${d}</div>`;
}
}

app.innerHTML=html;
}

/* PWA */
if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js");
}

</script>

</body>
</html>
