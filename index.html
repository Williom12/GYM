<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GYM</title>

<style>
*{box-sizing:border-box;}

body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  height:100vh;
  overflow:hidden;
}

.container{
  max-width:500px;
  margin:auto;
  height:100vh;
  position:relative;
}

.page{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  overflow-y:auto;
  padding:15px;
  background:#000;
  display:none;
}

.page.active{display:block;}

h2{text-align:center;}

button{
  width:100%;
  padding:14px;
  margin:6px 0;
  background:#111;
  color:#fff;
  border:1px solid #333;
  border-radius:10px;
  font-size:16px;
}

input{
  width:70px;
  background:#111;
  color:#fff;
  border:1px solid #333;
  border-radius:6px;
  text-align:center;
}

input[type="date"]{
  width:100%;
  padding:10px;
  margin:10px 0;
}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.dayCard{
  background:#111;
  padding:12px;
  margin:8px 0;
  border-radius:10px;
}

.deleteBtn{
  background:#300;
  margin-top:8px;
}

.detailBox{
  background:#111;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="container">

<div class="topbar">
<h2>GYM</h2>
<div id="streak">ðŸ”¥ 0</div>
</div>

<!-- PERFILES -->
<div id="profiles" class="page active">
<h2>Selecciona perfil</h2>
<button onclick="selectProfile('William')">William</button>
<button onclick="selectProfile('JuanManuel')">Juan Manuel</button>
</div>

<!-- MENU -->
<div id="menu" class="page">
<button onclick="openDay(1)">Dia 1</button>
<button onclick="openDay(2)">Dia 2</button>
<button onclick="openDay(3)">Dia 3</button>
<button onclick="openDay(4)">Dia 4</button>
<button onclick="openDay(5)">Dia 5</button>
<button onclick="openDias()">DÃ­as</button>
<button onclick="openProgreso()">Progreso</button>
</div>

<!-- DIA -->
<div id="dayPage" class="page">
<h2 id="dayTitle"></h2>
<input type="date" id="dayDate">
<div id="exerciseList"></div>
<button onclick="saveDay()">Guardar DÃ­a</button>
<button onclick="showPage('menu')">Volver</button>
</div>

<!-- HISTORIAL -->
<div id="dias" class="page">
<h2>DÃ­as registrados</h2>
<div id="daysList"></div>
<div id="dayDetail" class="detailBox" style="display:none"></div>
<button onclick="showPage('menu')">Volver</button>
</div>

<!-- PROGRESO -->
<div id="progreso" class="page">
<h2>Progreso</h2>
<canvas id="chart"></canvas>
<button onclick="showPage('menu')">Volver</button>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDE63KkdHA69nKOsguV4HHHpev74U4EGpg",
  authDomain: "gym-e61c4.firebaseapp.com",
  projectId: "gym-e61c4",
  storageBucket: "gym-e61c4.firebasestorage.app",
  messagingSenderId: "613694978439",
  appId: "1:613694978439:web:0c370ef36bcec8329a7b22",
  measurementId: "G-TY04V158X7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db=db;
window.fb={collection,addDoc,getDocs,deleteDoc,doc};

</script>

<script>
let currentProfile=null;
let currentDay=null;

const routines={
1:["Press inclinado mancuernas","Fondos paralelas","Aperturas mancuernas","Press cerrado","ExtensiÃ³n trÃ­ceps polea"],
2:["Dominadas","Remo barra","JalÃ³n pecho","Peso muerto rumano","Curl barra","Curl inclinado"],
3:["Sentadilla libre","Prensa","Curl femoral","ExtensiÃ³n cuÃ¡driceps","Gemelos pie"],
4:["Press militar","Elevaciones laterales","Elevaciones posteriores","Encogimientos barra","Crunch peso"],
5:["Press banca","Dominadas","Remo mancuerna","Curl + ExtensiÃ³n superserie"]
};

function showPage(id){
document.querySelectorAll(".page").forEach(p=>{
p.classList.remove("active");
p.scrollTop=0;
});
document.getElementById(id).classList.add("active");
window.scrollTo(0,0);
}

function selectProfile(name){
currentProfile=name;
updateStreak();
showPage("menu");
}

/* ðŸ”¥ DATA DESDE FIREBASE */
async function getData(){
const snap=await fb.getDocs(fb.collection(db,"workouts"));
let data=[];
snap.forEach(d=>data.push({...d.data(),id:d.id}));
return data.filter(d=>d.profile===currentProfile);
}

/* ABRIR DIA */
function openDay(n){
currentDay=n;

const today=new Date().toISOString().split("T")[0];
dayDate.value=today;
updateDayTitle();

exerciseList.innerHTML="";

routines[n].forEach((ex,i)=>{
exerciseList.innerHTML+=`
<p>${ex}
KG <input id="kg${i}">
Reps <input id="rep${i}">
</p>`;
});

showPage("dayPage");
}

dayDate.addEventListener("change",updateDayTitle);

function updateDayTitle(){
dayTitle.innerText=`Dia ${currentDay} ${dayDate.value}`;
}

/* GUARDAR NUBE */
async function saveDay(){

const exercises=routines[currentDay].map((ex,i)=>({
name:ex,
kg:document.getElementById("kg"+i).value||0,
reps:document.getElementById("rep"+i).value||0
}));

await fb.addDoc(
fb.collection(db,"workouts"),
{
profile:currentProfile,
day:currentDay,
date:dayDate.value,
exercises
});

updateStreak();
alert("Guardado en la nube â˜ï¸âœ…");
showPage("menu");
}

/* RACHA */
async function updateStreak(){
const data=await getData();
streak.innerText="ðŸ”¥ "+data.length;
}

/* DIAS */
async function openDias(){
await loadDays();
showPage("dias");
}

async function loadDays(){

daysList.innerHTML="";
dayDetail.style.display="none";

const data=await getData();

data.forEach(d=>{

const card=document.createElement("div");
card.className="dayCard";
card.innerHTML=`Dia ${d.day} - ${d.date}`;

card.onclick=()=>showDetail(d);

const del=document.createElement("button");
del.className="deleteBtn";
del.innerText="Eliminar";
del.onclick=async(e)=>{
e.stopPropagation();
await fb.deleteDoc(fb.doc(db,"workouts",d.id));
loadDays();
updateStreak();
};

card.appendChild(del);
daysList.appendChild(card);
});
}

/* DETALLE */
function showDetail(d){
dayDetail.style.display="block";

let html=`<h3>Dia ${d.day} - ${d.date}</h3>`;
d.exercises.forEach(ex=>{
html+=`<p>${ex.name} â€” ${ex.kg} KG / ${ex.reps} reps</p>`;
});

dayDetail.innerHTML=html;
}

/* PROGRESO */
let chart=null;

async function openProgreso(){
await drawChart();
showPage("progreso");
}

async function drawChart(){

const data=await getData();

const labels=data.map(d=>d.date);
const values=data.map((_,i)=>i+1);

if(chart) chart.destroy();

chart=new Chart(chart,{
type:"line",
data:{
labels,
datasets:[{
label:"Entrenamientos",
data:values
}]
},
options:{responsive:true}
});
}
</script>

</body>
</html>
